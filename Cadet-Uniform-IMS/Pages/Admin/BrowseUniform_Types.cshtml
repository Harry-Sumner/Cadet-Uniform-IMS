@page
@model Cadet_Uniform_IMS.Pages.Admin.BrowseUniformModel

@{
    ViewData["Title"] = "Index";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<h1>Clothing Types</h1>

<p>
    <a asp-page="CreateType">Create New</a>
</p>
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Size Attributes</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var types in Model.Types)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelTypes => types.TypeName)
                </td>
                <td>
                    @{
                        var attributes = Model.Attributes
                        .Where(i => i.TypeID == types.TypeID)
                        .Select(a => a.AttributeName);
                    }
                    @string.Join(", ", attributes)
                </td>
                <td>
                    <a asp-page="./EditType" asp-route-id="@types.TypeID">Edit</a>
                    <form asp-page-handler="DeleteType" asp-route-id="@types.TypeID" method="post">
                        <button class="submit" onclick="return confirm('Are you sure you want to delete this item? This will also delete all stock in this category.');">
                            Delete
                        </button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<h1>Uniform</h1>

<p>
    <a asp-page="CreateUniform">Create New</a>
</p>
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Uniform[0].Name)
            </th>
            <th>Type Name</th>
            <th>
                @Html.DisplayNameFor(model => model.Uniform[0].ImageData)
            </th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Uniform)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @foreach (var type in Model.Types.Where(i => i.TypeID == item.TypeID))
                    {
                        @type.TypeName
                    }
                </td>
                <td>
                    @{
                        //Reads image in bytes from database and then converts to an image and displays alt text for accessability, if no image present for item then black image icon used
                        try
                        {
                            <img src="@string.Format("data:image/jpg;base64, {0}", Convert.ToBase64String(item.ImageData))" alt="@Html.DisplayFor(modelItem => item.Name)" style="width:20%; height:20%;" />
                        }
                        catch
                        {
                            <img class="img-thumb" src="~/images/empty.png" alt="No Image Provided" style="width:20%; height:20%;" />
                        }
                    }
                </td>
                <td>
                    <a asp-page="./EditUniform" asp-route-id="@item.UniformID">Edit</a>
                    <form asp-page-handler="DeleteUniform" asp-route-id="@item.UniformID" method="post">
                        <button class="submit" onclick="return confirm('Are you sure you want to delete this item? This will also delete all stock in this category.');">
                            Delete
                        </button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>
